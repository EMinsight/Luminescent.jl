<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>fdtd_prerelease.jl · fdtd_prerelease</title><meta name="title" content="fdtd_prerelease.jl · fdtd_prerelease"/><meta property="og:title" content="fdtd_prerelease.jl · fdtd_prerelease"/><meta property="twitter:title" content="fdtd_prerelease.jl · fdtd_prerelease"/><meta name="description" content="Documentation for fdtd_prerelease."/><meta property="og:description" content="Documentation for fdtd_prerelease."/><meta property="twitter:description" content="Documentation for fdtd_prerelease."/><script data-outdated-warner src="assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="search_index.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href>fdtd_prerelease</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li class="is-active"><a class="tocitem" href>fdtd_prerelease.jl</a><ul class="internal"><li><a class="tocitem" href="#Overview"><span>Overview</span></a></li><li><a class="tocitem" href="#Quickstart"><span>Quickstart</span></a></li><li><a class="tocitem" href="#Installation"><span>Installation</span></a></li><li><a class="tocitem" href="#Implementation"><span>Implementation</span></a></li><li><a class="tocitem" href="#Sources"><span>Sources</span></a></li><li><a class="tocitem" href="#Boundaries"><span>Boundaries</span></a></li><li><a class="tocitem" href="#Monitors"><span>Monitors</span></a></li><li><a class="tocitem" href="#Physics"><span>Physics</span></a></li><li><a class="tocitem" href="#Tutorials"><span>Tutorials</span></a></li><li><a class="tocitem" href="#TODO"><span>TODO</span></a></li><li><a class="tocitem" href="#Community"><span>Community</span></a></li><li><a class="tocitem" href="#Contributors"><span>Contributors</span></a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>fdtd_prerelease.jl</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>fdtd_prerelease.jl</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/paulxshen/fdtd" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/paulxshen/fdtd/blob/master/makedocs/src/index.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="fdtd_prerelease.jl"><a class="docs-heading-anchor" href="#fdtd_prerelease.jl">fdtd_prerelease.jl</a><a id="fdtd_prerelease.jl-1"></a><a class="docs-heading-anchor-permalink" href="#fdtd_prerelease.jl" title="Permalink"></a></h1><p>Prerelease. Expect breaking changes</p><h2 id="Overview"><a class="docs-heading-anchor" href="#Overview">Overview</a><a id="Overview-1"></a><a class="docs-heading-anchor-permalink" href="#Overview" title="Permalink"></a></h2><p>Differentiable FDTD package for inverse design &amp; topology optimization in photonics, acoustics and RF. Uses automatic differentiation by <code>Zygote.jl</code> for adjoint optimization. Integrates with <code>Jello.jl</code> to generate length scale controlled paramaterized geometry . Staggered Yee grid update with fully featured boundary conditions &amp; sources. Customizable physics to potentially incorporate dynamics like heat transfer, charge transport.</p><h2 id="Quickstart"><a class="docs-heading-anchor" href="#Quickstart">Quickstart</a><a id="Quickstart-1"></a><a class="docs-heading-anchor-permalink" href="#Quickstart" title="Permalink"></a></h2><p>We do a quick 2d simulation of plane wave on periodic array of dielectric pillars in front of metal of plane <video src="assets/periodic_array_nres_32.mp4" controls="true" title><a href="assets/periodic_array_nres_32.mp4"></a></video></p><pre><code class="language-julia hljs">name = &quot;periodic_array&quot;
using UnPack,fdtd_prerelease
include(&quot;examples/utils/plot_recipes.jl&quot;)

&quot;simulation params&quot;
T = 20.0f0 # simulation duration in [periods]
nres = 32
Courant = 0.5f0 # Courant number
F = Float32

&quot;recording params&quot;
frameat = 1 / 16 # captures frame every _ periods
framerate = 16 # playback speed

dx = 1.0f0 / nres # pixel resolution in [wavelengths]
L = F[8, 8] # domain dimensions in [wavelengths]

# setup FDTD
polarization = :TMz
boundaries = [Periodic(2), PEC(1)] # unspecified boundaries default to PML
monitors = [Monitor([L / 2])]
sources = [PlaneWave(t -&gt; exp(-((t - 1) / 1)^2) * cos(F(2π) * t), -1; Jz=1)]
fdtd_configs = setup(boundaries, sources, monitors, L, dx, polarization; F, Courant, T)
@unpack esz0, hsz0, dt, geometry_padding, field_padding, source_effects, monitor_instances, fields = fdtd_configs

ϵ1 = 1 #
ϵ2 = 2.25f0 # 
b = F.([norm([x, y] .- esz0 ./ 2) &lt; 1 / dx for x = 1:esz0[1], y = 1:esz0[2]]) # circle

ϵ = ϵ2 * b + ϵ1 * (1 .- b)
μ = ones(F, hsz0)
σ = zeros(F, esz0)
σm = zeros(F, hsz0)
ϵ, μ, σ, σm = apply(geometry_padding; ϵ, μ, σ, σm)

p = [ϵ, μ, σ, σm]
u0 = collect(values(fields))

# run &amp; record simulation
@showtime sol = accumulate((u, t) -&gt; stepTMz(u, p, t, fdtd_configs), 0:dt:T, init=u0)
recordsim(sol, p, fdtd_configs, &quot;$(name)_nres_$nres.mp4&quot;, title=&quot;$name&quot;; frameat, framerate)</code></pre><p>&lt;!– <video src="assets/periodic_array_nres_32.mp4" controls="true" title="m"><a href="assets/periodic_array_nres_32.mp4">m</a></video> –&gt;</p><h2 id="Installation"><a class="docs-heading-anchor" href="#Installation">Installation</a><a id="Installation-1"></a><a class="docs-heading-anchor-permalink" href="#Installation" title="Permalink"></a></h2><p>Install via <code>Pkg.add(url=&quot;https://github.com/paulxshen/differentiable-fdtd-beta-prerelease&quot;)</code>. You can additionally access plotting and movie making scripts via <code>include(&quot;examples/utils/plot_recipes.jl&quot;)</code> (may need to modify path)</p><h2 id="Implementation"><a class="docs-heading-anchor" href="#Implementation">Implementation</a><a id="Implementation-1"></a><a class="docs-heading-anchor-permalink" href="#Implementation" title="Permalink"></a></h2><p>Supports 1d (Ez, Hy), 2d TMz (Ez, Hx, Hy), 2d TEz (Hz, Ex, Ey) and 3d. Length and time are in units of wavelength and period. This normalization allows usage of relative  permitivity and permeability  in equations . Fields including electric, magnetic and current density are simply bundled as a vector of arrays . Boundary conditions pad the field arrays . PML paddings are multilayered, stateful and permanent, increasing size of field and geometry arrays. All other boundaries only add transient single layers which are subsequently consumed by finite differencing  every update step. Paddings are coordinated to implictly implement staggered Yee&#39;s grid for finite differencing.</p><h2 id="Sources"><a class="docs-heading-anchor" href="#Sources">Sources</a><a id="Sources-1"></a><a class="docs-heading-anchor-permalink" href="#Sources" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Main.fdtd_prerelease.PlaneWave" href="#Main.fdtd_prerelease.PlaneWave"><code>Main.fdtd_prerelease.PlaneWave</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">function PlaneWave(f, dims; fields...)</code></pre><p>Constructs plane wave source</p><p>Args</p><ul><li>f: time function</li><li>dims: eg -1 for wave coming from -x edge</li><li>fields: which fields to excite &amp; their scaling constants (typically a current source, eg Jz=1)</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/paulxshen/fdtd/blob/2acdb8429e394dde09ac00e9fb1b901f59befcff/src/sources.jl#L26-L35">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Main.fdtd_prerelease.GaussianBeam" href="#Main.fdtd_prerelease.GaussianBeam"><code>Main.fdtd_prerelease.GaussianBeam</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">function GaussianBeam(f, σ, center, dims; fields...)</code></pre><p>Constructs gaussian beam source</p><p>Args</p><ul><li>f: time function</li><li>σ: std dev length</li><li>dims: eg 1 for x direction</li><li>fields: which fields to excite &amp; their scaling constants (typically a current source, eg Jz=1)</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/paulxshen/fdtd/blob/2acdb8429e394dde09ac00e9fb1b901f59befcff/src/sources.jl#L45-L55">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Main.fdtd_prerelease.UniformSource" href="#Main.fdtd_prerelease.UniformSource"><code>Main.fdtd_prerelease.UniformSource</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">function UniformSource(f, lengths, center; fields...)</code></pre><p>Constructs uniform source</p><p>Args</p><ul><li>f: time function</li><li>fields: which fields to excite &amp; their scaling constants (typically a current source, eg Jz=1)</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/paulxshen/fdtd/blob/2acdb8429e394dde09ac00e9fb1b901f59befcff/src/sources.jl#L88-L96">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Main.fdtd_prerelease.CenteredSource" href="#Main.fdtd_prerelease.CenteredSource"><code>Main.fdtd_prerelease.CenteredSource</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">function CenteredSource(f, g, center, L; fields...)</code></pre><p>Constructs custom centered source. Can be used to specify modal sources</p><p>Args</p><ul><li>f: time function</li><li>g: spatial function</li><li>L: source dimensions in [wavelengths]</li><li>fields: which fields to excite &amp; their scaling constants (typically a current source, eg Jz=1)</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/paulxshen/fdtd/blob/2acdb8429e394dde09ac00e9fb1b901f59befcff/src/sources.jl#L66-L76">source</a></section></article><h2 id="Boundaries"><a class="docs-heading-anchor" href="#Boundaries">Boundaries</a><a id="Boundaries-1"></a><a class="docs-heading-anchor-permalink" href="#Boundaries" title="Permalink"></a></h2><p>Unspecified boundaries default to PML </p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Main.fdtd_prerelease.Periodic" href="#Main.fdtd_prerelease.Periodic"><code>Main.fdtd_prerelease.Periodic</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">Periodic(dims)</code></pre><p>periodic boundary</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/paulxshen/fdtd/blob/2acdb8429e394dde09ac00e9fb1b901f59befcff/src/boundaries.jl#L3-L7">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Main.fdtd_prerelease.PML" href="#Main.fdtd_prerelease.PML"><code>Main.fdtd_prerelease.PML</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">function PML(dims, d=0.5f0, σ=8.0f0)</code></pre><p>Constructs perfectly matched layers (PML aka ABC, RBC) boundary of depth <code>d</code> wavelengths </p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/paulxshen/fdtd/blob/2acdb8429e394dde09ac00e9fb1b901f59befcff/src/boundaries.jl#L30-L34">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Main.fdtd_prerelease.PEC" href="#Main.fdtd_prerelease.PEC"><code>Main.fdtd_prerelease.PEC</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">PEC(dims)</code></pre><p>perfect electrical conductor</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/paulxshen/fdtd/blob/2acdb8429e394dde09ac00e9fb1b901f59befcff/src/boundaries.jl#L11-L15">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Main.fdtd_prerelease.PMC" href="#Main.fdtd_prerelease.PMC"><code>Main.fdtd_prerelease.PMC</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">PMC(dims)</code></pre><p>perfect magnetic conductor</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/paulxshen/fdtd/blob/2acdb8429e394dde09ac00e9fb1b901f59befcff/src/boundaries.jl#L19-L23">source</a></section></article><h2 id="Monitors"><a class="docs-heading-anchor" href="#Monitors">Monitors</a><a id="Monitors-1"></a><a class="docs-heading-anchor-permalink" href="#Monitors" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Main.fdtd_prerelease.Monitor" href="#Main.fdtd_prerelease.Monitor"><code>Main.fdtd_prerelease.Monitor</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">function Monitor(span, normal=nothing)</code></pre><p>Constructs monitor which can span a point, line, surface, or volume</p><p>Args</p><ul><li>span</li><li>normal: flux monitor direction</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/paulxshen/fdtd/blob/2acdb8429e394dde09ac00e9fb1b901f59befcff/src/monitors.jl#L2-L10">source</a></section></article><h2 id="Physics"><a class="docs-heading-anchor" href="#Physics">Physics</a><a id="Physics-1"></a><a class="docs-heading-anchor-permalink" href="#Physics" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Main.fdtd_prerelease.step1" href="#Main.fdtd_prerelease.step1"><code>Main.fdtd_prerelease.step1</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">function step1(u, p, t, configs)</code></pre><p>Updates fields for 1D (Ez, Hy)</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/paulxshen/fdtd/blob/2acdb8429e394dde09ac00e9fb1b901f59befcff/src/maxwell.jl#L1-L5">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Main.fdtd_prerelease.stepTMz" href="#Main.fdtd_prerelease.stepTMz"><code>Main.fdtd_prerelease.stepTMz</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">function stepTMz(u, p, t, configs)</code></pre><p>Updates fields for 2d TMz</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/paulxshen/fdtd/blob/2acdb8429e394dde09ac00e9fb1b901f59befcff/src/maxwell.jl#L33-L37">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Main.fdtd_prerelease.stepTEz" href="#Main.fdtd_prerelease.stepTEz"><code>Main.fdtd_prerelease.stepTEz</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">function stepTEz(u, p, t, configs)</code></pre><p>Updates fields for 2d TEz (Hz, Ex, Ey)</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/paulxshen/fdtd/blob/2acdb8429e394dde09ac00e9fb1b901f59befcff/src/maxwell.jl#L65-L69">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Main.fdtd_prerelease.step3" href="#Main.fdtd_prerelease.step3"><code>Main.fdtd_prerelease.step3</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">function step3(u, p, t, configs)</code></pre><p>Updates fields for 3d</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/paulxshen/fdtd/blob/2acdb8429e394dde09ac00e9fb1b901f59befcff/src/maxwell.jl#L97-L101">source</a></section></article><h2 id="Tutorials"><a class="docs-heading-anchor" href="#Tutorials">Tutorials</a><a id="Tutorials-1"></a><a class="docs-heading-anchor-permalink" href="#Tutorials" title="Permalink"></a></h2><p>Hosted on Google Colab simulation</p><ul><li><a href="https://colab.research.google.com/drive/1SiP7MvSE4P05uNgostV9WWx3pFQtFYDW?usp=sharing">2d<em>periodic</em>array</a></li></ul><p>inverse_design</p><ul><li><a href="https://colab.research.google.com/drive/1-g6ShK54MbSsAAeE2c5cj5g7OY7CXfpy?usp=sharing">2d<em>waveguide</em>bend</a></li></ul><h2 id="TODO"><a class="docs-heading-anchor" href="#TODO">TODO</a><a id="TODO-1"></a><a class="docs-heading-anchor-permalink" href="#TODO" title="Permalink"></a></h2><ul><li>integration with external mode solver (suggestions welcome ) for modal source profiles </li><li>far field transforms</li><li>your wonderful suggestion ;)</li></ul><h2 id="Community"><a class="docs-heading-anchor" href="#Community">Community</a><a id="Community-1"></a><a class="docs-heading-anchor-permalink" href="#Community" title="Permalink"></a></h2><p>Discussion &amp; updates at <a href="https://discourse.julialang.org/t/pre-ann-differentiable-fdtd-for-inverse-design-in-photonics-acoustics-and-rf/105405/12">Julia Discourse</a></p><h2 id="Contributors"><a class="docs-heading-anchor" href="#Contributors">Contributors</a><a id="Contributors-1"></a><a class="docs-heading-anchor-permalink" href="#Contributors" title="Permalink"></a></h2><p>Paul Shen &lt;pxshen@alumni.stanford.edu&gt;</p></article><nav class="docs-footer"><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="auto">Automatic (OS)</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.2.1 on <span class="colophon-date" title="Saturday 30 December 2023 14:56">Saturday 30 December 2023</span>. Using Julia version 1.9.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
